var map = L.map('map').setView(currPos, 20.0);

L.tileLayer('http://localhost:5000/static/maps/'+ mapName +'/{z}/{x}/{y}.png', {
        minZoom: 8,
        maxZoom: 20,
        tms: false,
        attribution: 'Generated by TilesXYZ'
    }).addTo(map);
curr_pos = L.circle(currPos, {
    color: "blue",
    fillColor: "#f03",
    fillOpacity: 0.85,
    radius: 1.25
}).addTo(map)
    .openPopup();

var latlngs = []
var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
var eleCurrPos = document.getElementById('current-position');

var getJson = async (callback) => {
    var res = await fetch('/getJson', {cache: "no-cache"});
    var resJson = await res.json();
    latlngs = resJson['LatLongs']
    currPos = resJson['live']
    console.log(latlngs);
    callback();
};

function addLine() {
    getJson(function () {
        polyline = L.polyline(latlngs, {color: 'red'}).addTo( map );
        curr_pos.setLatLng(currPos);
        })
};


function tracking() {
    var btn_track =  document.getElementById('btn-track');
    if (btn_track.innerHTML == 'View live'){
        btn_track.innerHTML = 'Stop';
        addLine_Interval = setInterval(addLine, 2000);
    } else {
        // btn_track.href =Flask.url_for('finishTrack', {'mapid': mapid});
        btn_track.innerHTML = 'Done';
        clearInterval(addLine_Interval);
    }
    
}
