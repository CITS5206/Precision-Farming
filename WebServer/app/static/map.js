var map = L.map('map').setView([currentLat, currentLong], 16.0);

L.tileLayer('http://localhost:5000/static/maps/'+ mapName +'/{z}/{x}/{y}.png', {
        minZoom: 8,
        maxZoom: 20,
        tms: false,
        attribution: 'Generated by TilesXYZ'
    }).addTo(map);
curr_pos =L.marker([currentLat, currentLong]).addTo(map)
    .openPopup();

var latlngs = []
var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);

var getJson = async (callback) => {
    var res = await fetch('/getJson', {cache: "no-cache"});
    var resJson = await res.json();
    latlngs = resJson['coordinates']
    //check correct coordinates in browser's console
    currPos = resJson['CURRENT_POS']
    console.log(latlngs);
    //draw polyline when done
    callback();
};

function addLine() {
    getJson(function () {
        polyline.removeFrom(map);
        polyline = L.polyline(latlngs, {color: 'red'}).addTo( map );
        })
};


function tracking() {
    var btn_track =  document.getElementById('btn-track')
    if (btn_track.innerHTML == 'Start Tracking'){
        btn_track.innerHTML = 'Stop and Save'
        addLine_Interval = setInterval(addLine, 2000);
    } else {
        btn_track.href =Flask.url_for('finishTrack', {'mapid': mapid});
        // btn_track.innerHTML = 'Done'
        clearInterval(addLine_Interval);
    }
    
}
